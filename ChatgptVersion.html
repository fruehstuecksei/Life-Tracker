<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LifeTracker</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0f172a">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

<style>
:root {
    --bg: #0f172a;
    --card: rgba(255,255,255,0.06);
    --border: rgba(255,255,255,0.1);
    --primary: #3b82f6;
    --success: #22c55e;
    --danger: #ef4444;
    --text: #f1f5f9;
}

* { box-sizing: border-box; }

body {
    margin: 0;
    font-family: 'Inter', sans-serif;
    background: radial-gradient(circle at top, #1e293b, #0f172a);
    color: var(--text);
    padding: 20px;
}

h1 {
    text-align: center;
    font-weight: 800;
    font-size: 28px;
    margin-bottom: 30px;
}

.section {
    background: var(--card);
    backdrop-filter: blur(20px);
    border: 1px solid var(--border);
    border-radius: 18px;
    padding: 20px;
    margin-bottom: 25px;
    box-shadow: 0 8px 25px rgba(0,0,0,0.3);
    animation: fadeIn 0.4s ease;
}

h2 {
    margin-top: 0;
    font-weight: 600;
}

button {
    padding: 10px 16px;
    border-radius: 12px;
    border: none;
    cursor: pointer;
    font-weight: 600;
    background: var(--primary);
    color: white;
    transition: all 0.2s ease;
}

button:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 15px rgba(59,130,246,0.4);
}

button.stop {
    background: var(--danger);
}

button.counter {
    background: var(--success);
}

input {
    padding: 10px;
    border-radius: 10px;
    border: 1px solid var(--border);
    background: rgba(255,255,255,0.05);
    color: white;
    width: 120px;
}

.category-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin: 10px 0;
}

.status {
    font-weight: 600;
}

.running { color: var(--success); }
.stopped { color: var(--danger); }

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}
</style>
</head>

<body>

<h1>üöÄ LifeTracker</h1>

<div class="section">
    <h2>Modus</h2>
    <select id="modeSwitcher" onchange="switchMode()">
        <option value="test">Test</option>
        <option value="prod">Production</option>
    </select>
</div>

<div class="section">
    <h2>‚è± Timer</h2>
    <div id="timerContainer"></div>

    <input id="newTimerCategory" type="text" placeholder="Neue Kategorie">
    <button onclick="addTimerCategory()">+ Hinzuf√ºgen</button>
</div>

<div class="section">
    <h2>üèã Counter</h2>
    <div id="counterContainer"></div>

    <input id="newCounterCategory" type="text" placeholder="Neue Kategorie">
    <button onclick="addCounterCategory()">+ Hinzuf√ºgen</button>
</div>

<script>
const URLS = {
    test: "https://n8n.srv1377935.hstgr.cloud/webhook-test/lifetracker",
    prod: "https://n8n.srv1377935.hstgr.cloud/webhook/lifetracker"
};

let currentMode = "test";
let timerCategories = JSON.parse(localStorage.getItem("timerCats")) || ["sleep","sport","eating"];
let counterCategories = JSON.parse(localStorage.getItem("counterCats")) || ["pushups","pullups"];
let timerState = JSON.parse(localStorage.getItem("timerState")) || {};

function switchMode() {
    currentMode = document.getElementById("modeSwitcher").value;
}

function saveState() {
    localStorage.setItem("timerCats", JSON.stringify(timerCategories));
    localStorage.setItem("counterCats", JSON.stringify(counterCategories));
    localStorage.setItem("timerState", JSON.stringify(timerState));
}

function renderTimers() {
    const container = document.getElementById("timerContainer");
    container.innerHTML = "";

    timerCategories.forEach(cat => {
        const running = timerState[cat] === true;
        container.innerHTML += `
            <div class="category-row">
                <button class="${running ? "stop" : ""}" onclick="sendTimer('${cat}')">
                    ${running ? "Stop" : "Start"} ${cat}
                </button>
                <span class="status ${running ? "running" : "stopped"}">
                    ${running ? "üü¢ l√§uft" : "üî¥ gestoppt"}
                </span>
            </div>
        `;
    });
}

function renderCounters() {
    const container = document.getElementById("counterContainer");
    container.innerHTML = "";

    counterCategories.forEach(cat => {
        container.innerHTML += `
            <div class="category-row">
                <input id="${cat}" type="number" placeholder="${cat}">
                <button class="counter" onclick="sendCounter('${cat}')">Senden</button>
            </div>
        `;
    });
}

function sendTimer(category) {
    timerState[category] = !timerState[category];
    saveState();
    renderTimers();

    fetch(URLS[currentMode], {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({
            event: timerState[category] ? "timer_start" : "timer_stop",
            category: category,
            timestamp: Math.floor(Date.now()/1000)
        })
    });
}

function sendCounter(category) {
    const value = document.getElementById(category).value;
    if (!value) return;

    fetch(URLS[currentMode], {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({
            event: "counter",
            category: category,
            value: Number(value),
            timestamp: Math.floor(Date.now()/1000)
        })
    });

    document.getElementById(category).value = "";
}

function addTimerCategory() {
    const input = document.getElementById("newTimerCategory");
    const newCat = input.value.trim();
    if (!newCat || timerCategories.includes(newCat)) return;

    timerCategories.push(newCat);
    timerState[newCat] = false;
    saveState();
    renderTimers();
    input.value = "";
}

function addCounterCategory() {
    const input = document.getElementById("newCounterCategory");
    const newCat = input.value.trim();
    if (!newCat || counterCategories.includes(newCat)) return;

    counterCategories.push(newCat);
    saveState();
    renderCounters();
    input.value = "";
}

renderTimers();
renderCounters();

if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('sw.js');
}
</script>

</body>
</html>

