<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>LifeTracker</title>
<style>
    /* Reset */
    * { box-sizing: border-box; margin:0; padding:0; }

    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #f0f4f8, #d9e2ec);
        min-height: 100vh;
        padding: 30px;
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    h1 {
        font-size: 2.2rem;
        color: #1f2937;
        margin-bottom: 30px;
        text-align: center;
        text-shadow: 0 1px 2px rgba(0,0,0,0.1);
    }

    .section {
        background: white;
        border-radius: 16px;
        padding: 25px 30px;
        width: 100%;
        max-width: 600px;
        margin-bottom: 30px;
        box-shadow: 0 10px 25px rgba(0,0,0,0.08);
        transition: transform 0.2s ease;
    }
    .section:hover { transform: translateY(-3px); }

    h2 { margin-bottom: 15px; color: #334155; }
    h3 { margin-top: 20px; margin-bottom: 10px; color: #475569; font-size: 1rem; }

    select {
        padding: 10px 12px;
        border-radius: 8px;
        border: 1px solid #ccc;
        font-size: 15px;
    }

    button {
        padding: 10px 16px;
        margin: 5px 5px 5px 0;
        font-size: 15px;
        cursor: pointer;
        border-radius: 10px;
        border: none;
        background: linear-gradient(90deg,#3b82f6,#60a5fa);
        color: white;
        font-weight: bold;
        transition: all 0.2s ease;
        box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    }
    button:hover {
        background: linear-gradient(90deg,#2563eb,#3b82f6);
        transform: translateY(-2px);
        box-shadow: 0 6px 12px rgba(0,0,0,0.2);
    }

    input {
        padding: 10px 12px;
        font-size: 15px;
        border-radius: 10px;
        border: 1px solid #ccc;
        margin-right: 10px;
        width: 140px;
    }

    .status {
        font-weight: bold;
        margin-left: 12px;
        font-size: 0.95rem;
    }
    .running { color: #16a34a; }
    .stopped { color: #dc2626; }

    .category-row {
        display: flex;
        align-items: center;
        margin-bottom: 12px;
        justify-content: space-between;
    }

    .timer-counter-row {
        display: flex;
        justify-content: space-between;
        flex-wrap: wrap;
    }

    .timer-counter-row div {
        flex: 1 1 48%;
        margin-bottom: 12px;
    }

    .timer-counter-row input {
        width: calc(100% - 90px);
    }

    .live-timer {
        font-family: 'Courier New', Courier, monospace;
        margin-left: 10px;
        font-size: 0.95rem;
        color: #0f172a;
    }

</style>
</head>
<body>

<h1>LifeTracker üí™‚è±</h1>

<div class="section">
    <h2>Modus</h2>
    <select id="modeSwitcher" onchange="switchMode()">
        <option value="test">Test</option>
        <option value="prod">Production</option>
    </select>
</div>

<div class="section">
    <h2>Timer</h2>
    <div id="timerContainer"></div>

    <h3>Neue Kategorie hinzuf√ºgen</h3>
    <input id="newTimerCategory" type="text" placeholder="Neue Kategorie">
    <button onclick="addTimerCategory()">Hinzuf√ºgen</button>
</div>

<div class="section">
    <h2>Counter</h2>
    <div id="counterContainer"></div>

    <h3>Neue Kategorie hinzuf√ºgen</h3>
    <input id="newCounterCategory" type="text" placeholder="Neue Kategorie">
    <button onclick="addCounterCategory()">Hinzuf√ºgen</button>
</div>

<script>
const URLS = {
    test: "https://n8n.srv1377935.hstgr.cloud/webhook-test/lifetracker",
    prod: "https://n8n.srv1377935.hstgr.cloud/webhook/lifetracker"
};
let currentMode = "test";
function switchMode() { currentMode = document.getElementById("modeSwitcher").value; }

let timerCategories = ["sleep", "sport", "eating"];
let counterCategories = ["pushups", "pullups"];
let timerState = {};
let liveTimers = {};

function renderTimers() {
    const container = document.getElementById("timerContainer");
    container.innerHTML = "";

    timerCategories.forEach(cat => {
        const running = timerState[cat] === true;
        let liveTime = liveTimers[cat] || 0;
        let liveDisplay = running ? `<span class="live-timer">${formatSeconds(liveTime)}</span>` : "";

        container.innerHTML += `
            <div class="category-row">
                <button onclick="sendTimer('${cat}')">${cat} Start/Stop</button>
                <span class="status ${running ? "running" : "stopped"}">
                    ${running ? "üü¢ l√§uft" : "üî¥ gestoppt"}
                </span>
                ${liveDisplay}
            </div>
        `;
    });
}

function renderCounters() {
    const container = document.getElementById("counterContainer");
    container.innerHTML = "";

    counterCategories.forEach(cat => {
        container.innerHTML += `
            <div class="category-row">
                <input id="${cat}" type="number" placeholder="${cat}">
                <button onclick="sendCounter('${cat}')">Senden</button>
            </div>
        `;
    });
}

function addTimerCategory() {
    const input = document.getElementById("newTimerCategory");
    const newCat = input.value.trim();
    if (!newCat) return;
    if (!timerCategories.includes(newCat)) {
        timerCategories.push(newCat);
        timerState[newCat] = false;
        liveTimers[newCat] = 0;
        renderTimers();
    }
    input.value = "";
}

function addCounterCategory() {
    const input = document.getElementById("newCounterCategory");
    const newCat = input.value.trim();
    if (!newCat) return;
    if (!counterCategories.includes(newCat)) {
        counterCategories.push(newCat);
        renderCounters();
    }
    input.value = "";
}

function sendTimer(category) {
    const running = !(timerState[category] || false);
    timerState[category] = running;

    if (running) liveTimers[category] = 0; // reset timer when starting
    renderTimers();

    fetch(URLS[currentMode], {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({
            event: running ? "timer_start" : "timer_stop",
            category: category,
            timestamp: Math.floor(Date.now() / 1000)
        })
    });
}

function sendCounter(category) {
    const value = document.getElementById(category).value;
    if (!value) return;

    fetch(URLS[currentMode], {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({
            event: "counter",
            category: category,
            value: Number(value),
            timestamp: Math.floor(Date.now() / 1000)
        })
    });

    document.getElementById(category).value = "";
}

// Helper: Format Sekunden zu HH:MM:SS
function formatSeconds(sec) {
    const h = Math.floor(sec/3600);
    const m = Math.floor((sec%3600)/60);
    const s = sec%60;
    return `${String(h).padStart(2,"0")}:${String(m).padStart(2,"0")}:${String(s).padStart(2,"0")}`;
}

// Live Timer Update
setInterval(() => {
    Object.keys(timerState).forEach(cat => {
        if (timerState[cat]) liveTimers[cat]++;
    });
    renderTimers();
}, 1000);

// Initial Render
timerCategories.forEach(cat => liveTimers[cat] = 0);
renderTimers();
renderCounters();
</script>
</body>
</html>
